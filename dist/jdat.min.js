/*! jdat - v0.1.0 - 2013-12-13
* https://github.com/medihack/jdat
* Copyright (c) 2013 Kai Schlamp; Licensed MIT */
var JDat=JDat||{};JDat.Registry=JDat.Registry||{},JDat.extend=function(a,b,c){var d=function(){};d.prototype=b.prototype,a.prototype=new d,a.prototype.constructor=a,$.extend(a.prototype,c)},JDat.ColorHelper={hex2hsv:function(a){var b=parseInt(a.slice(1),16),c=b>>16&255,d=b>>8&255,e=255&b;return this.rgb2hsv([c,d,e])},hsv2hex:function(a){var b=this.hsv2rgb(a);return this.rgb2hex(b)},hsv2rgb:function(a){var b,c,d,e,f,g=a[0]%360/60;f=a[2]*a[1],e=f*(1-Math.abs(g%2-1)),b=c=d=a[2]-f,g=~~g,b+=[f,e,0,0,e,f][g],c+=[e,f,f,e,0,0][g],d+=[0,0,e,f,f,e][g];var h=Math.floor(255*b),i=Math.floor(255*c),j=Math.floor(255*d);return[h,i,j]},rgb2hex:function(a){var b=a[0],c=a[1],d=a[2];return"#"+(16777216|d|c<<8|b<<16).toString(16).slice(1)},rgb2hsv:function(a){var b=a[0],c=a[1],d=a[2];(a[0]>1||a[1]>1||a[2]>1)&&(b/=255,c/=255,d/=255);var e,f,g,h;return g=Math.max(b,c,d),h=g-Math.min(b,c,d),e=0==h?null:g==b?(c-d)/h+(d>c?6:0):g==c?(d-b)/h+2:(b-c)/h+4,e=e%6*60,f=0==h?0:h/g,[e,f,g]}},JDat.FieldController=function(){var a={id:null,binding:null,label:null,titleize:!1,disabled:!1,hidden:!1,onChange:null,onFinishChange:null,onSetup:null,onUpdateView:function(a,b){this.value(a[b],!1)},onUpdateModel:function(a,b,c){a[b]=c}},b=function(b,c,d){if(this._el=b,this._options=$.extend({},a,c),this._eventBus=d,this._render(),this._eventBus){var e=this;this._eventBus.bind("jdat.updateView",function(){e._options.model&&e._options.binding&&e._options.onUpdateView.call(e,e._options.model,e._options.binding)})}this._options.disabled&&this.disable(),this._options.hidden&&this._el.hide(),this._options.onSetup&&this._options.onSetup.call(this)};return b.prototype={constructor:b,_initialize:function(){this._options.model&&this._options.binding?this._options.onUpdateView.call(this,this._options.model,this._options.binding):this._options.value&&this.value(this._options.value,!1)},_trigger:function(a,b){a.source=this,this._options.model&&this._options.binding&&this._options.onUpdateModel.call(this,this._options.model,this._options.binding,a.value,b),this._options.onChange&&this._options.onChange.call(this,a),(void 0===b||b)&&this._options.onFinishChange&&this._options.onFinishChange.call(this,a)},_template:function(){var a=$('<div class="jdat-field-container">').appendTo(this._el);if(!this._options.label)return a;var b=$('<div class="jdat-field-panel">'),c=$('<span class="jdat-field-label">');return this._options.titleize&&c.addClass("jdat-title"),a.append(c).append(b),this.label(this._options.label),b},id:function(){return this._options.id},label:function(a){return void 0===a?this._options.label:(this._options.label=a,this._el.find(".jdat-field-label").text(a),void 0)},onChange:function(a){return void 0===a?this._options.onChange:(this._options.onChange=a,void 0)},show:function(a){var b=this;this._el.slideDown("fast",function(){$(this).show(),$.isFunction(a)&&a.call(b)}),this._options.hidden=!1},hide:function(a){var b=this;this._el.slideUp("fast",function(){$(this).hide(),$.isFunction(a)&&a.call(b)}),this._options.hidden=!0},enable:function(){this._el.find($(".jdat-field-disabler").remove()),this._options.disabled=!1},disable:function(a){var b=this._el.find(".jdat-field-disabler");b.length||(b=$('<div class="jdat-field-disabler">').appendTo(this._el),a&&b.addClass("jdat-loading")),this._options.disabled=!0}},b}(),JDat.SectionController=function(){var a={label:"Section",title:!0,closeable:!0,closed:!1,indent:!0},b=function(b,c,d){var e=$.extend({},a,c);JDat.FieldController.call(this,b,e,d),this._bindClose(),this._options.closed&&this.close()};return JDat.extend(b,JDat.FieldController,{_render:function(){this._options.title&&(this._template().remove(),this._el.find(".jdat-field-label").addClass("jdat-section-title").addClass("jdat-title"),this._options.closeable&&this._el.find(".jdat-field-container").prepend($('<div class="jdat-arrow-down">')));var a=$('<ul class="jdat-section-panel">').appendTo(this._el);this._options.indent&&a.addClass("jdat-indent")},_bindClose:function(){var a=this;this._options.closeable&&this._el.find(".jdat-field-container:eq(0)").click(function(){return a.closed?a.open():a.close(),!1})},add:function(a,b){var c=JDat.Registry[a];if(!c)return console.error("Controller of type '"+a+"' does not exist."),null;var d=$("<li>").addClass("jdat-field").addClass("jdat-"+a).appendTo(this._el.find(".jdat-section-panel:eq(0)"));b.id&&d.attr("id",b.id),!b.model&&this._options.model&&(b.model=this._options.model);var e=new c(d,b,this._eventBus);return d.data("jdat",e),e},open:function(a){var b=this;this._el.find(".jdat-section-panel:eq(0)").slideDown("fast",function(){$(this).show(),$.isFunction(a)&&a.call(b)}),this._el.find(".jdat-arrow-right:eq(0)").removeClass("jdat-arrow-right").addClass("jdat-arrow-down"),this.closed=!1},close:function(a){var b=this;this._el.find(".jdat-section-panel:eq(0)").slideUp("fast",function(){$(this).hide(),$.isFunction(a)&&a.call(b)}),this._el.find(".jdat-arrow-down:eq(0)").removeClass("jdat-arrow-down").addClass("jdat-arrow-right"),this.closed=!0},empty:function(){this._el.find(".jdat-section-panel:eq(0)").empty()}}),b}(),JDat.Registry.section=JDat.SectionController,JDat.Widget=function(){var a={resizeable:!0,resizer:"right",closeBar:"bottom",openLabel:"Open",closeLabel:"Close",titleBar:!0,title:"",undockable:!0,removable:!0,collapsible:!0,settings:!1,onSettings:function(){},model:null},b=function(b,c){this._el=b,this._options=$.extend({},a,c),this._eventBus=$({}),this._render(),this._bindClose(),this._bindResize(),this._bindRemove(),this._bindDocking(),this.closed&&this.close()};return JDat.extend(b,JDat.SectionController,{_render:function(){var a=this;if(this.widget=$('<div class="jdat-widget">'),this._options.resizeable){var b=$('<div class="jdat-resizer">');"right"==this._options.resizer?b.addClass("jdat-right"):b.addClass("jdat-left"),b.appendTo(this.widget)}if(this._options.titleBar&&this._createTitleBar(),this.widget.append($('<ul class="jdat-section-panel">')),this._options.closeBar){var c=$('<a href="#" class="jdat-closebar">').text(a._options.closeLabel);"bottom"==this._options.closeBar?this.widget.append(c):this.widget.prepend(c)}this.widget.appendTo(this._el)},_createTitleBar:function(){var a=$('<div class="jdat-titlebar">');this._options.resizeable&&a.append($('<div class="jdat-resize-knob">')),this._options.title&&a.append($('<div class="jdat-titlebar-title jdat-title">').text(this._options.title)),this._options.removable&&a.append($('<button class="jdat-remove">')),this._options.collapsible&&a.append($('<button class="jdat-collapse">')),this._options.undockable&&a.append($('<button class="jdat-undock">')),this._options.settings&&a.append($('<button class="jdat-settings">')),a.appendTo(this.widget)},_bindClose:function(){var a=this;this.widget.find(".jdat-closebar, button.jdat-collapse").click(function(){return a.closed?a.open():a.close(),!1})},_bindResize:function(){var a=this;this.widget.find(".jdat-resizer").mousedown(function(b){if(1===b.which){var c=a.widget.width(),d=function(a){return c+a},e=[b.pageX,b.pageY];return $(window).on("mousemove.jdatDrag",function(b){var c=[b.pageX,b.pageY],f=c[0]-e[0];return"left"==a._options.resizer&&(f=-f),a.resize(d(f)),!1}),$(window).one("mouseup",function(){return $(window).off("mousemove.jdatDrag"),!1}),!1}})},_bindRemove:function(){var a=this;this.widget.find(".jdat-titlebar .jdat-remove").click(function(){return a.remove(),!1})},_bindDocking:function(){var a=this;this.widget.find(".jdat-titlebar .jdat-undock").on("click",function(){return a.undocked?a.dock():a.undock(),!1}),this.widget.find(".jdat-titlebar").mousedown(function(b){if(a.undocked&&1===b.which){var c=a.widget.offset(),d=b.pageX-c.left,e=b.pageY-c.top;return $(window).on("mousemove.jdatDrag",function(b){var c=b.pageX-d,f=b.pageY-e;return a.widget.css("left",c),a.widget.css("top",f),!1}),$(window).one("mouseup.jdatDrag",function(){return $(window).off("mousemove.jdatDrag"),!1}),!1}})},_bindSettings:function(){var a=this;this.widget.find(".jdat-settings").click(function(){a._options.onSettings.call(a)})},open:function(a){var b=this;this.widget.find("ul:eq(0)").slideDown("fast",function(){$(this).show(),$.isFunction(a)&&a.call(b)}),this.widget.find(".jdat-closebar").text(this._options.closeLabel),this.widget.find("button.jdat-expand").removeClass("jdat-expand").addClass("jdat-collapse"),this.closed=!1},close:function(a){var b=this;this.widget.find("ul:eq(0)").slideUp("fast",function(){$(this).hide(),$.isFunction(a)&&a.call(b)}),this.widget.find(".jdat-closebar").text(this._options.openLabel),this.widget.find("button.jdat-collapse").removeClass("jdat-collapse").addClass("jdat-expand"),this.closed=!0},resize:function(a){this.widget.width(a)},empty:function(){this.widget.find(".jdat-section-panel:eq(0)").empty()},remove:function(){this.widget.fadeOut("fast",function(){$(this).remove()})},undock:function(){if(!this.undocked){var a=this.widget.offset();this.widget.detach().appendTo("body").css("position","absolute").css("left",a.left).css("top",a.top),this.widget.find("button.jdat-undock").removeClass("jdat-undock").addClass("jdat-dock"),"left"==this._options.resizer&&this.widget.find(".jdat-resizer").removeClass("jdat-left").addClass("jdat-right"),this.dockedPosition=[a.left,a.top],this.undocked=!0}},dock:function(){if(this.undocked){var a=this,b=function(){a.widget.detach().appendTo(a._el).css("position","").css("left","").css("top",""),a.widget.find("button.jdat-dock").removeClass("jdat-dock").addClass("jdat-undock"),"left"==a._options.resizer&&a.widget.find(".jdat-resizer").removeClass("jdat-right").addClass("jdat-left")},c=this.widget.offset();c.left!==this.dockedPosition[0]||c.top!==this.dockedPosition[1]?this.widget.animate({left:this.dockedPosition[0],top:this.dockedPosition[1]},function(){b()}):b(),this.undocked=!1}},updateView:function(){this._eventBus.trigger("jdat.updateView")}}),b}(),!function(a){"use strict";a.fn.jdat=function(b){return this.each(function(){var c=a(this),d=c.data("jdat");d||c.data("jdat",new JDat.Widget(c,b))})}}(window.jQuery),JDat.ButtonsController=function(){var a={label:"Button",holdTimeout:500,buttons:[]},b=function(b,c,d){var e=$.extend({},a,c);JDat.FieldController.call(this,b,e,d),this._bindButtons()};return JDat.extend(b,JDat.FieldController,{_render:function(){var a=this._template();$.each(this._options.buttons,function(b,c){if("string"==typeof c)a.append($("<button>").html(c));else{for(var d in c)break;a.append($("<button>").data("jdat-buttonId",buttonid).html(c.buttonId))}})},_bindButtons:function(){var a=this,b=this._el.find("button"),c=0,d=0;b.mousedown(function(b){c=1;var e=$(b.currentTarget),f=e.data("jdat-buttonId");f||(f=e);var g={value:f},h=a._options.holdTimeout,i=function(){2==c&&a._trigger(g,!1),c=2,d=setTimeout(i,h)};i();var j=function(){return clearTimeout(d),c>0&&a._trigger(g,!0),c=0,!1};return $(b.currentTarget).one("mouseup",j),$(b.currentTarget).one("mouseleave",j),!1})}}),b}(),JDat.Registry.buttons=JDat.ButtonsController,JDat.CheckBoxController=function(){var a={label:"Check Box",value:!1},b=function(b,c,d){var e=$.extend({},a,c);JDat.FieldController.call(this,b,e,d),this._bindInput(),this._initialize()};return JDat.extend(b,JDat.FieldController,{_render:function(){this._template().append($('<input type="checkbox">'))},_bindInput:function(){var a=this;this._el.find("input").change(function(b){var c=$(b.currentTarget).is(":checked");return a.value(c,!0,!0),!1})},value:function(a,b,c){if(void 0===a)return this._options.value;var a=Boolean(a);this._el.find("input").attr("checked",a),this._options.value=a;var d={value:a};b&&this._trigger(d,c)}}),b}(),JDat.Registry.checkbox=JDat.CheckBoxController,JDat.ColorBarController=function(){var a={label:"Color Bar",colors:[],onHover:function(){}},b=function(b,c,d){var e=$.extend({},a,c);JDat.FieldController.call(this,b,e,d),this._bindHover()};return JDat.extend(b,JDat.FieldController,{_render:function(){var a=this._template(),b=$('<div class="jdat-colorbar-container">');a.append(b),this.container=b;var c=$('<canvas class="jdat-colorbar-canvas">');b.append(c),this.ctx=c[0].getContext("2d");var d=$('<div class="jdat-colorbar-marker">');b.append(d),this.marker=d;var e=$('<div class="jdat-colorbar-caption">');b.append(e),this.caption=e;var f=this.ctx.canvas.width,g=this.ctx.canvas.height,h=this.ctx.createLinearGradient(0,0,f,0),i=this._options.colors;$.each(i,function(a,b){var c=a/(i.length-1);h.addColorStop(c,b)}),this.ctx.fillStyle=h,this.ctx.fillRect(0,0,f,g)},_bindHover:function(){var a=this;this.container.mousemove(function(b){var c=$(a.ctx.canvas),d=c.offset(),e=Math.round(b.pageX-d.left),f=e/(c.width()-1);a.marker.show(),f>=0&&1>=f?a.marker.css("left",e+"px"):(0>f&&(f=0),f>1&&(f=1));var g=a._options.onHover.call(a,f);return g?a.caption.html(g).show():a.caption.hide(),!1}),this.container.mouseleave(function(){return a.marker.hide(),a.caption.hide(),!1})},getColor:function(a,b){var c=this.ctx.canvas,d=c.width,e=(d-1)*a,f=this.ctx.getImageData(e,0,1,1).data,g=[f[0],f[1],f[2]];return"rgb"==b?g:"hsv"==b?JDat.ColorHelper.rgb2hsv(g):JDat.ColorHelper.rgb2hex(g)}}),b}(),JDat.Registry.colorbar=JDat.ColorBarController,JDat.ColorSelectController=function(){var a={label:"Color Select",value:"#ffffff"},b=function(b,c,d){var e=$.extend({},a,c);JDat.FieldController.call(this,b,e,d),this._bindInput(),this._bindSelector(),this._initialize()};return JDat.extend(b,JDat.FieldController,{_render:function(){this._template().append($('<input type="text">').attr("spellcheck","false")).append(function(){return $('<div class="jdat-colorpicker">').append($('<div class="jdat-saturation-field">').append($('<div class="jdat-saturation-inner">')).append($('<div class="jdat-saturation-knob">'))).append($('<div class="jdat-hue-field">').append($('<div class="jdat-hue-knob">'))).append($('<button class="jdat-colorpicker-close">×</button>'))})},_bindInput:function(){var a=this,b=this._el.find(".jdat-colorpicker");this._el.find("input").change(function(b){var c=$(b.currentTarget).val();return a.value(c,!0,!0),!1}).mousedown(function(c){$(this).parents(".jdat-widget").find(".jdat-colorpicker").hide(),b.show(),a._selectColor(a.hex,a.hsv),$(document).one("mousedown",function(){b.hide()}),c.stopPropagation()})},_bindSelector:function(){this._bindHue(),this._bindSaturation();var a=this._el.find(".jdat-colorpicker");a.mousedown(function(){return!1}),a.find(".jdat-colorpicker-close").click(function(){a.hide()})},_bindHue:function(){var a=this;this._el.find(".jdat-hue-field").mousedown(function(b){if(1===b.which){var c=$(this),d=c.offset().top,e=c.height(),f=function(a){var b=1-a/e;return b>1&&(b=1),0>b&&(b=0),b*=360},g=function(b,c){var e=b-d;a.hsv[0]=f(e),a._value("hsv",a.hsv,!0,c)};return g(b.pageY,!1),$(window).on("mousemove.jdatDrag",function(a){return g(a.pageY,!1),!1}),$(window).one("mouseup",function(a){return g(a.pageY,!0),$(window).off("mousemove.jdatDrag"),!1}),!1}})},_bindSaturation:function(){var a=this;this._el.find(".jdat-saturation-field").mousedown(function(b){if(1===b.which){var c=$(this),d=c.offset(),e=c.width(),f=c.height(),g=function(a){var b=a/e;return b>1&&(b=1),0>b&&(b=0),b},h=function(a){var b=1-a/f;return b>1&&(b=1),0>b&&(b=0),b},i=function(b,c,e){var f=b-d.left,i=c-d.top;a.hsv[1]=g(f),a.hsv[2]=h(i),a._value("hsv",a.hsv,!0,e)};return i(b.pageX,b.pageY,!1),$(window).on("mousemove.jdatDrag",function(a){return i(a.pageX,a.pageY,!1),!1}),$(window).one("mouseup",function(a){return i(a.pageX,a.pageY,!0),$(window).off("mousemove.jdatDrag"),!1}),!1}})},_setInput:function(a,b){var c=a,d=b[2]>.5&&b[1]<.5?"#000":"#fff";this._el.find("input").val(a).css("backgroundColor",c).css("color",d)},_selectColor:function(a,b){var c=this,d=this._el.find(".jdat-saturation-field"),e=function(a){var b=["-moz-","-o-","-webkit-","-ms-",""],c=JDat.ColorHelper.hsv2hex([a,1,1]),e="linear-gradient(left, #fff 0%, "+c+" 100%)";$.each(b,function(a,b){d.css("background",b+e)})},f=this._el.find(".jdat-hue-field").height(),g=this._el.find(".jdat-hue-knob"),h=function(a){var b=(1-a/360)*f;0>b&&(b=0),b>=f&&(b=f-1),g.css("top",b+"px")},i=this._el.find(".jdat-saturation-field"),j=i.width(),k=i.height(),l=c._el.find(".jdat-saturation-knob"),m=function(b,c){var d=j*b,e=(1-c)*k;0>d&&(d=0),0>e&&(e=0),d>=j&&(d=j-1),e>=k&&(e=k-1),l.css("left",d+"px"),l.css("top",e+"px"),l.css("backgroundColor",a)};e(b[0]),h(b[0]),m(b[1],b[2])},_value:function(a,b,c,d){var e,f;"hex"==a?(e=b,f=JDat.ColorHelper.hex2hsv(e)):(f=b,e=JDat.ColorHelper.hsv2hex(f)),this.hex=e,this.hsv=f,this._setInput(e,f),this._selectColor(e,f);var g=this._options.value;if(this._options.value=e,c){var h={value:e,previous:g};this._trigger(h,d)}},value:function(a,b,c){if(void 0===a)return this._options.value;a=a.replace(/^\s+|\s+$/g,""),a=a.toLowerCase();var d,e=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,f=/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/;null!==(d=a.match(e))&&(a="#",a+=d[1]+d[1],a+=d[2]+d[2],a+=d[3]+d[3]),null===(d=a.match(f))&&(a=this._options.value,b=!1),this._value("hex",a,b,c)}}),b}(),JDat.Registry.colorselect=JDat.ColorSelectController,JDat.ComboBoxController=function(){var a={label:"ComboBox",selectOptions:[],value:""},b=function(b,c,d){var e=$.extend({},a,c);JDat.FieldController.call(this,b,e,d),this._bindSelect(),this.selectOptions(this._options.selectOptions),this._initialize()};return JDat.extend(b,JDat.FieldController,{_render:function(){this._template().append($("<select>"))},_fillSelect:function(a){var b=this._options.selectOptions;$.each(b,function(b,c){var d,e;if("string"==typeof c)d=c,e=c;else{for(d in c)break;e=c[d]}a.append($("<option>").attr("value",d).text(e))})},_bindSelect:function(){var a=this;this._el.find("select").change(function(){var b=this.value;return a.value(b,!0,!0),!1})},selectOptions:function(a){if(void 0===a)return this._options.selectOptions;this._options.selectOptions=a;var b=this._el.find("select").empty();this._fillSelect(b),b.prop("disabled",0==a.length)},value:function(a,b,c){if(void 0===a)return this._el.find("select").val();var d=this._el.find('select option[value="'+a+'"]');if(0!=d.length){d.is(":selected")||d.attr("selected","selected");var e=this._options.value;if(this._options.value=a,b){var f={value:a,previous:e};this._trigger(f,c)}}}}),b}(),JDat.Registry.combobox=JDat.ComboBoxController,JDat.CustomController=function(){var a={label:"Custom",hasLabel:!0,classes:[],render:function(){}},b=function(b,c,d){var e=$.extend({},a,c);JDat.FieldController.call(this,b,e,d)};return JDat.extend(b,JDat.FieldController,{_render:function(){$.each(this._options.classes,function(a,b){this._el.addClass(b)});var a=this._options.render(this);this._options.hasLabel?this._template().append(a):this._el.append(a)}}),b}(),JDat.Registry.custom=JDat.CustomController,JDat.ProgressBarController=function(){var a={label:"Progress Bar",value:0,text:"Loading ..."},b=function(b,c,d){var e=$.extend({},a,c);JDat.FieldController.call(this,b,e,d),this.value(this._options.value,!1),this.text(this._options.text)};return JDat.extend(b,JDat.FieldController,{_render:function(){var a=$('<div class="jdat-progressbar-bg">').append($('<span class="jdat-progressbar-fg">')).append($('<div class="jdat-progressbar-overlay">'));this._template().append(a)},value:function(a,b,c){if(void 0===a)return this._options.value;a=parseInt(a),isNaN(a)?(a=this._options.value,b=!1):(0>a||a>100)&&(a=this._options.value,b=!1);var d=this._options.value;if(this._options.value=a,this._el.find(".jdat-progressbar-bg span").css("width",a+"%"),b){var e={value:a,previous:d};this._trigger(e,c)}},text:function(a){return void 0===a?this._options.text:(this._el.find(".jdat-progressbar-overlay").text(a),void 0)}}),b}(),JDat.Registry.progressbar=JDat.ProgressBarController,JDat.SliderController=function(){var a={label:"Slider",max:100,min:1,step:1,value:50},b=function(b,c,d){var e=$.extend({},a,c);JDat.FieldController.call(this,b,e,d),this._bindSlide(),this._bindInput(),this._initialize()};return JDat.extend(b,JDat.FieldController,{_render:function(){this._template().append($('<input type="text">')).append(function(){return $('<div class="jdat-slider-bg">').append($('<div class="jdat-slider-fg">'))})},_bindSlide:function(){var a=this;this._el.find(".jdat-slider-bg").mousedown(function(b){if(1===b.which){var c=a._el.find(".jdat-slider-bg"),d=c.offset(),e=c.width(),f=a._options.min,g=a._options.max,h=function(b,c){var h=d.left,i=f+(g-f)*((b-h)/e);a.value(i,!0,c)};return h(b.pageX,!1),$(window).on("mousemove.jdatDrag",function(a){return h(a.pageX,!1),!1}),$(window).one("mouseup",function(a){return h(a.pageX,!0),$(window).off("mousemove.jdatDrag"),!1}),!1}})},_bindInput:function(){var a=this;this._el.find("input").change(function(b){var c=$(b.currentTarget).val();return a.value(c,!0,!0),!1}).mousedown(function(b){if(1===b.which){var c=b.pageY,d=a._options.step,e=a._options.value,f=e;$(window).on("mousemove.jdatDrag",function(b){var g=c-b.pageY;return f=g/10*d+e,a.value(f,!0,!1),!1}),$(window).one("mouseup",function(){return a.value(f,!0,!0),$(window).off("mousemove.jdatDrag"),!1})}})},_setSlider:function(){var a=this._options.value,b=this._options.max,c=this._options.min,d=(a-c)/(b-c),e=100*d+"%";this._el.find(".jdat-slider-fg").width(e)},_setInput:function(){var a=this._options.value;this._el.find("input").val(a)},label:function(a){return void 0===a?this._options.label:(this._options.label=a,this._el.find(".jdat-field-label").text(a),void 0)},max:function(a,b,c){return void 0===a?this._options.max:(this._options.max=a,this._options.value>a&&this.value(this._options.value,b,c),void 0)},min:function(a,b,c){return void 0===a?this._options.min:(this._options.min=a,this._options.value<a&&this.value(this._options.value,b,c),void 0)},step:function(a){return void 0===a?this._options.step:(this._options.step=a,void 0)},value:function(a,b,c){if(void 0===a)return this._options.value;a=Number(a),isNaN(a)&&(a=this._options.value,b=!1),a<this._options.min?a=this._options.min:a>this._options.max&&(a=this._options.max);var d=this._options.step;if(a%d!=0){var e=String(d),f=0;e.indexOf(".")>-1&&(f=e.length-e.indexOf(".")-1);var g=Math.pow(10,f);a=Math.round(a/d)*d,a=Math.round(a*g)/g}var h=this._options.value;if(this._options.value=a,this._setSlider(),this._setInput(),b){var i={value:a,previous:h};this._trigger(i,c)}}}),b}(),JDat.Registry.slider=JDat.SliderController,JDat.StringController=function(){var a={label:"String",value:"",maxLength:100,minLength:0,regexp:null,strip:!1},b=function(b,c,d){var e=$.extend({},a,c);JDat.FieldController.call(this,b,e,d),this._bindInput(),this._initialize()};return JDat.extend(b,JDat.FieldController,{_render:function(){this._template().append($('<input type="text">'))},_bindInput:function(){var a=this;this._el.find("input").change(function(b){var c=$(b.currentTarget).val();return a.value(c,!0,!0),!1}).keyup(function(b){if(13!=b.keyCode){var c=$(b.currentTarget).val();a.value(c,!0,!1)}})},value:function(a,b,c){if(void 0===a)return this._options.value;var d=!0;this._options.strip&&(a=a.replace(/^\s+|\s+$/g,""));var e=a.length;(e>this._options.maxLength||e<this._options.minLength)&&(d=!1);var f=this._options.regexp;f&&!f.test(a)&&(d=!1),d||(a=this._options.value,b=!1);var g=this._options.value;if(this._options.value=a,this._el.find("input").val(a),b){var h={value:a,previous:g};this._trigger(h,c)}},minLength:function(a){return void 0===a?this._options.minLength:(a=Number(a),this._options.minLength=a,void 0)},maxLength:function(a){return void 0===a?this._options.maxLength:(a=Number(a),this._options.maxLength=a,void 0)},strip:function(a){return void 0===a?this._options.stip:(a=Boolean(a),this._options.strip=a,void 0)},regexp:function(a){return void 0===a?this._options.regexp:(a=RegExp(a),this._options.regexp=a,void 0)}}),b}(),JDat.Registry.string=JDat.StringController,JDat.ToggleController=function(){var a={label:"Toggle",value:!1},b=function(b,c,d){var e=$.extend({},a,c);JDat.FieldController.call(this,b,e,d),this._bindToggle(),this._initialize()};return JDat.extend(b,JDat.FieldController,{_render:function(){this._template().append($('<div class="jdat-toggle-bg">').append($('<div class="jdat-toggle-fg">').text("OFF")))},_bindToggle:function(){var a=this;this._el.find(".jdat-toggle-bg").click(function(){return a.value(!a.value(),!0,!0),!1})},value:function(a,b,c){if(void 0===a)return this._options.value;var a=Boolean(a),d=this._el.find(".jdat-toggle-fg");a?(d.addClass("jdat-toggle-on"),d.text("ON")):(d.removeClass("jdat-toggle-on"),d.text("OFF")),this._options.value=a;var e={value:a};b&&this._trigger(e,c)}}),b}(),JDat.Registry.toggle=JDat.ToggleController;